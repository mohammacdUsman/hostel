<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HostelHub - Premium</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

    <style>
        /* LOADER */
        #global-loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 99999; display: flex; justify-content: center; align-items: center; flex-direction: column; transition: opacity 0.5s; }
        .loader-ring { width: 80px; height: 80px; border: 5px solid rgba(212,175,55,0.2); border-top: 5px solid #D4AF37; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        .loader-brand { font-family: 'Cinzel', serif; font-size: 24px; font-weight: 700; animation: pulse 1.5s infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes pulse { 50% { opacity: 0.5; } }

        /* SIDEBAR */
        .sidebar { height: 100vh; width: 280px; position: fixed; top: 0; left: -320px; background: #1c1c1c; padding-top: 100px; overflow-y: auto; transition: 0.5s; z-index: 1040; box-shadow: 10px 0 30px rgba(0,0,0,0.1); }
        .sidebar.active { left: 0; }
        
        /* NAV PROFILE IMAGE */
        .nav-profile-img { width: 45px; height: 45px; object-fit: cover; border: 2px solid #D4AF37; border-radius: 50%; transition: 0.3s; }
        .nav-profile-img:hover { transform: scale(1.1); box-shadow: 0 0 10px #D4AF37; }
    </style>
</head>
<body>

<div id="global-loader">
    <div class="loader-ring"></div>
    <div class="loader-brand">Hostel<span style="color: #D4AF37;">Hub</span></div>
</div>

<!-- HEADER -->
<div class="premium-header">
    <div class="d-flex align-items-center">
        <i class="bi bi-list menu-trigger me-3" onclick="toggleSidebar()"></i>
        <a href="/" class="brand-gold">HostelHub</a>
    </div>
    
    <!-- RIGHT SIDE (Fixed Alignment) -->
    <div class="d-flex align-items-center gap-3">
        <% if (user) { %>
            <!-- Profile Pic -->
            <a href="/profile" title="My Profile">
                <img src="<%= (user.profile_pic && user.profile_pic !== 'default.png') ? '/uploads/' + user.profile_pic : 'https://ui-avatars.com/api/?name=' + user.name + '&background=D4AF37&color=fff' %>" 
                     class="nav-profile-img" alt="Profile">
            </a>
            <!-- Logout Button -->
            <a href="/logout" class="btn btn-sm btn-outline-danger rounded-pill px-3 fw-bold">
                <i class="bi bi-box-arrow-right"></i> Logout
            </a>
        <% } else { %>
            <a href="/login" class="btn btn-dark rounded-pill btn-sm px-4" style="background: #D4AF37; border:none; font-weight:bold;">Login</a>
        <% } %>
    </div>
</div>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
    <div class="text-center mb-4 mt-2">
        <% if (user) { %>
            <img src="<%= (user.profile_pic && user.profile_pic !== 'default.png') ? '/uploads/' + user.profile_pic : 'https://ui-avatars.com/api/?name=' + user.name + '&background=D4AF37&color=fff' %>" 
                 class="rounded-circle mb-2 shadow" style="width: 70px; height: 70px; object-fit: cover; border: 3px solid #D4AF37; padding: 2px;">
            <h6 class="text-white mb-0 fw-bold" style="font-family: 'Cinzel';"><%= user.name %></h6>
            <small class="text-white-50" style="font-size: 11px;"><%= user.role.toUpperCase() %></small>
        <% } else { %>
            <h4 class="text-white" style="font-family: 'Cinzel';">MENU</h4>
        <% } %>
    </div>

    <a href="/"><i class="bi bi-house me-2"></i> Home</a>
    <a href="/about"><i class="bi bi-info-circle me-2"></i> About Us</a>
    <a href="/contact"><i class="bi bi-envelope me-2"></i> Contact Us</a>

    <% if (user) { %>
        <a href="/profile"><i class="bi bi-person-circle me-2"></i> My Profile</a>
        <a href="/community"><i class="bi bi-people-fill me-2"></i> Community Chat</a>
    <% } %>

    <hr class="border-secondary mx-3">

    <% if (user && user.role === 'student') { %>
        <small class="text-muted ms-4 mb-2 d-block">STUDENT PANEL</small>
        <a href="/my_bookings"><i class="bi bi-calendar-check me-2"></i> My Bookings</a>
        <a href="/my_wishlist"><i class="bi bi-heart me-2"></i> Saved Hostels</a>
        <a href="/chat_list"><i class="bi bi-chat-dots me-2"></i> Messages 
            <% if(locals.unreadCount > 0) { %> <span class="badge bg-danger rounded-circle p-1"> </span> <% } %>
        </a>
    <% } %>

    <% if (user && user.role === 'owner') { %>
        <small class="text-muted ms-4 mb-2 d-block">OWNER PANEL</small>
        <a href="/owner_dashboard"><i class="bi bi-speedometer2 me-2"></i> Dashboard</a>
        <a href="/add_hostel"><i class="bi bi-plus-lg me-2"></i> Add Hostel</a>
        <a href="/chat_list"><i class="bi bi-chat-dots me-2"></i> Messages
            <% if(locals.unreadCount > 0) { %> <span class="badge bg-danger rounded-circle p-1"> </span> <% } %>
        </a>
    <% } %>

    <% if (user && user.role === 'admin') { %>
        <small class="text-muted ms-4 mb-2 d-block">ADMIN CONTROL</small>
        <a href="/admin_dashboard"><i class="bi bi-shield-lock me-2"></i> Admin Panel</a>
    <% } %>
</div>

<div class="sidebar-overlay" id="overlay" onclick="toggleSidebar()"></div>

<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script>
    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('active');
        document.getElementById('overlay').classList.toggle('active');
    }
    window.addEventListener("load", function () {
        document.getElementById("global-loader").style.opacity = "0"; 
        setTimeout(() => { document.getElementById("global-loader").style.display = "none"; }, 500);
    });
</script>
</body>
</html>